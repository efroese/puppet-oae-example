#!/bin/sh

JAVA_HOME=<%= java_home %>

JAVA_OPTS="-server -d64 -Xms5g -Xmx5g -Djava.awt.headless=true -XX:MaxNewSize=1500m -XX:PermSize=512m -XX:MaxPermSize=768m -XX:+UseConcMarkSweepGC -XX:+CMSIncrementalMode -XX:+CMSIncrementalPacing -XX:+DisableExplicitGC"
CATALINA_PID="$CATALINA_HOME/work/cle.pid"

JAVA_OPTS="$JAVA_OPTS -Dorg.apache.jasper.compiler.Parser.STRICT_QUOTE_ESCAPING=false -Dhttp.agent=Sakai-News-Tool"

# Uncomment the following line if using JDK 1.6
JAVA_OPTS="$JAVA_OPTS -Dsun.lang.ClassLoader.allowArraySyntax=true"

#uncomment the following line and enter the timezone if different than server's
#  some examples for the U.S.:  US/Eastern, US/Central, US/Mountain, US/Pacific, US/Arizona
JAVA_OPTS="$JAVA_OPTS -Duser.timezone=US/Pacific"

## for debugging--print garbage collection info
JAVA_OPTS="$JAVA_OPTS -verbose:gc -XX:+PrintGCTimeStamps -XX:+PrintGCDetails"

JAVA_OPTS="$JAVA_OPTS -Dsakai.home=<%= scope.lookupvar('tomcat6::parentdir') %>/tomcat/sakai"

# app dynamics config is specifc to server, so must be a local file, not shared like this one.
#. ${CATALINA_HOME}/bin/appdynamics.sh

# erase indexwork area on restart
if [[ "$1" == "start" ]]; then
  echo "in startup, remove indexwork, set up jmx"
  rm -rf <%= scope.lookupvar('tomcat6::parentdir') %>/tomcat/sakai/indexwork/*
fi

JAVA_OPTS="$JAVA_OPTS -Djavax.net.ssl.trustStore=/home/rsmart/ssl/cacerts -Djavax.net.ssl.trustStorePassword=s3cUreD -Djavax.net.ssl.keyStore=/home/rsmart/ssl/cacerts -Djavax.net.ssl.keyStorePassword=s3cUreD -Dsakai.cookieName=SAKAI2SESSIONID"

LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$CATALINA_HOME/lib
export LD_LIBRARY_PATH

CATALINA_OPTS="-Dcom.sun.management.jmxremote \
    -Dcom.sun.management.jmxremote.port=8995 \
    -Dcom.sun.management.jmxremote.ssl=false \
    -Dcom.sun.management.jmxremote.authenticate=true \
    -Dcom.sun.management.jmxremote.password.file=$CATALINA_HOME/conf/jmxremote.password \
    -Dcom.sun.management.jmxremote.access.file=$CATALINA_HOME/conf/jmxremote.access"
